<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>PinCache.swift</title>
<meta property="og:title" content="PinCache.swift"><meta property="og:image" content="https://joemattiello.dev/img/twitter.jpg"><meta name=description content="iOS Platform Engineer with experience leveraging Swift, MVVM, Rx, agile, DevOps, and CI/CD to manage large scale mobile applications."><meta property="og:description" content="iOS Platform Engineer with experience leveraging Swift, MVVM, Rx, agile, DevOps, and CI/CD to manage large scale mobile applications."><meta name=author content="Joseph Mattiello"><link href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel=stylesheet><link href=https://use.fontawesome.com/releases/v5.5.0/css/all.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css rel=stylesheet><link href=https://joemattiello.dev/css/resume.css rel=stylesheet><link href=https://joemattiello.dev/css/tweaks.css rel=stylesheet><link href=https://joemattiello.dev/css/iconsfordevs.css rel=stylesheet><meta name=generator content="Hugo 0.139.3"><link rel="shortcut icon" href=favicon.ico><link rel=icon type=image/x-icon sizes="16x16 32x32" href=favicon.ico><link rel=icon sizes=192x192 href=favicon-192.png><link rel=apple-touch-icon sizes=180x180 href=favicon-180-precomposed.png><meta name=msapplication-TileColor content="#FFFFFF"><meta name=msapplication-TileImage content="favicon-114-precomposed.png"></head><body id=page-top><nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id=sideNav><a class="navbar-brand js-scroll-trigger" href=#page-top><span class="d-block d-lg-none">Joseph Mattiello</span>
<span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src=/img/twitter.jpg alt>
</span></a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class=navbar-nav><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#about>About</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#skills>Skills</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#projects>Projects</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#open>Open Source</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#publications>Publications</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#experience>Experience</a></li><li class=nav-item><a class="nav-link js-scroll-trigger" href=/#education>Education</a></li></ul></div></nav><div class="container-fluid p-0"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://joemattiello.dev/>Home</a></li><li class=breadcrumb-item><a href=https://joemattiello.dev/projects/>Projects</a></li><li class=breadcrumb-item><a href=https://joemattiello.dev/projects/creations/>Creations</a></li><li class="breadcrumb-item active"><a href=https://joemattiello.dev/projects/creations/pincache_swift/>PinCache.swift</a></li></ol></nav><section class="resume-section p-3 p-lg-5 d-flex d-column"><div class=my-auto><h2 class=mb-0><span class=text-primary>PinCache.swift</span></h2><p>PinCache.swift is a custom Swift re-write of <a href=https://github.com/pinterest/PINCache>Pintrist&rsquo;s PINCache</a>, that retrains full Objective-C backwards compatibility while enabling optional advanced Swift language features using protocols and default implimentations.</p><hr><h1 id=pincache>PINCache</h1><p><a href=http://cocoadocs.org/docsets/PINCache/><img src=https://img.shields.io/cocoapods/v/PINCache.svg alt=CocoaPods></a>
<a href=https://github.com/Carthage/Carthage><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a>
<a href="https://github.com/pinterest/PINCache/actions?query=workflow%3ACI+branch%3Amaster"><img src=https://github.com/pinterest/PINCache/workflows/CI/badge.svg alt="Build status"></a></p><h2 id=fast-non-deadlocking-parallel-object-cache-for-ios-and-os-x>Fast, non-deadlocking parallel object cache for iOS and OS X.</h2><p><a href=Source/PINCache.h>PINCache</a> is a fork of <a href=https://github.com/tumblr/TMCache>TMCache</a> re-architected to fix issues with deadlocking caused by heavy use. It is a key/value store designed for persisting temporary objects that are expensive to reproduce, such as downloaded data or the results of slow processing. It is comprised of two self-similar stores, one in memory (<a href=Source/PINMemoryCache.h>PINMemoryCache</a>) and one on disk (<a href=Source/PINDiskCache.h>PINDiskCache</a>), all backed by GCD and safe to access from multiple threads simultaneously. On iOS, <code>PINMemoryCache</code> will clear itself when the app receives a memory warning or goes into the background. Objects stored in <code>PINDiskCache</code> remain until you trim the cache yourself, either manually or by setting a byte or age limit.</p><p><code>PINCache</code> and <code>PINDiskCache</code> accept any object conforming to <a href=https://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Protocols/NSCoding_Protocol/Reference/Reference.html>NSCoding</a>. Put things in like this:</p><p><strong>Objective-C</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>UIImage <span style=color:#f92672>*</span>img <span style=color:#f92672>=</span> [[UIImage alloc] initWithData:data scale:[[UIScreen mainScreen] scale]];
</span></span><span style=display:flex><span>[[PINCache sharedCache] setObject:img forKey:<span style=color:#e6db74>@&#34;image&#34;</span> block:nil]; <span style=color:#75715e>// returns immediately
</span></span></span></code></pre></div><p><strong>Swift</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> img = UIImage(data: data, scale:UIScreen.main.scale)
</span></span><span style=display:flex><span>PINCache.shared().setObject(img, forKey: <span style=color:#e6db74>&#34;img&#34;</span>)
</span></span></code></pre></div><p>Get them back out like this:</p><p><strong>Objective-C</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>[[PINCache sharedCache] objectForKeyAsync:<span style=color:#e6db74>@&#34;image&#34;</span> block:<span style=color:#f92672>^</span>(PINCache <span style=color:#f92672>*</span>cache, NSString <span style=color:#f92672>*</span>key, <span style=color:#66d9ef>id</span> object) {
</span></span><span style=display:flex><span>    UIImage <span style=color:#f92672>*</span>image <span style=color:#f92672>=</span> (UIImage <span style=color:#f92672>*</span>)object;
</span></span><span style=display:flex><span>    NSLog(<span style=color:#e6db74>@&#34;image scale: %f&#34;</span>, image.scale);
</span></span><span style=display:flex><span>}];
</span></span></code></pre></div><p><strong>Swift</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>PINCache.shared().object(forKey: <span style=color:#e6db74>&#34;image&#34;</span>) { (cache, key, object) <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> image = object <span style=color:#66d9ef>as</span>? UIImage {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;image scale: %f&#34;</span>, image.scale)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Both <code>PINMemoryCache</code> and <code>PINDiskCache</code> use locks to protect reads and writes. <code>PINCache</code> coordinates them so that objects added to memory are available immediately to other threads while being written to disk safely in the background. Both caches are public properties of <code>PINCache</code>, so it&rsquo;s easy to manipulate one or the other separately if necessary.</p><p>Collections work too. Thanks to the magic of <code>NSKeyedArchiver</code>, objects repeated in a collection only occupy the space of one on disk:</p><p><strong>Objective-C</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span>NSArray <span style=color:#f92672>*</span>images <span style=color:#f92672>=</span> <span style=color:#ae81ff>@[</span> image, image, image <span style=color:#ae81ff>]</span>;
</span></span><span style=display:flex><span>[[PINCache sharedCache] setObject:images forKey:<span style=color:#e6db74>@&#34;images&#34;</span>];
</span></span><span style=display:flex><span>NSLog(<span style=color:#e6db74>@&#34;3 for the price of 1: %d&#34;</span>, [[[PINCache sharedCache] diskCache] byteCount]);
</span></span></code></pre></div><p><strong>Swift</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// In Swift, Array, String, and Dictionary are all value types.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> images = [image, image, image] <span style=color:#66d9ef>as</span> NSArray <span style=color:#75715e>// Cast to NSArray</span>
</span></span><span style=display:flex><span>PINCache.shared.setObject(images, forKey: <span style=color:#e6db74>&#34;images&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;3 for the prices of 1: %d&#34;</span>, PINCache.shared.diskCache.byteCount)
</span></span></code></pre></div><h2 id=installation>Installation</h2><h3 id=manually>Manually</h3><p><a href=https://github.com/pinterest/PINCache/tags>Download the latest tag</a> and drag the <code>PINCache</code> folder into your Xcode project.</p><p>Install the docs by double clicking the <code>.docset</code> file under <code>docs/</code>, or view them online at <a href=http://cocoadocs.org/docsets/PINCache/>cocoadocs.org</a></p><h3 id=git-submodule>Git Submodule</h3><pre><code>git submodule add https://github.com/pinterest/PINCache.git
git submodule update --init
</code></pre><h3 id=cocoapods>CocoaPods</h3><p>Add <a href="http://cocoapods.org/?q=name%3APINCache">PINCache</a> to your <code>Podfile</code> and run <code>pod install</code>.</p><h3 id=carthage>Carthage</h3><p>Add the following line to your <code>Cartfile</code> and run <code>carthage update --platform ios</code>. Then follow <a href=https://github.com/carthage/carthage#adding-frameworks-to-unit-tests-or-a-framework>this instruction of Carthage</a> to embed the framework.</p><p><code>github "pinterest/PINCache"</code></p><h2 id=requirements>Requirements</h2><p><strong>PINCache</strong> requires iOS 8.0, tvOS 9.0, watchOS 2.0 or macOS 10.8 and greater.</p><h2 id=contact>Contact</h2><p><a href=mailto:garrett@pinterest.com>Garrett Moon</a></p><h2 id=license>License</h2><p>Copyright 2013 Tumblr, Inc.
Copyright 2015 Pinterest, Inc.</p><p>Licensed under the Apache License, Version 2.0 (the &ldquo;License&rdquo;); you may not use this file except in compliance with the License. You may obtain a copy of the License at <a href=http://www.apache.org/licenses/LICENSE-2.0>http://www.apache.org/licenses/LICENSE-2.0</a></p><p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &ldquo;AS IS&rdquo; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. <a href=LICENSE.txt>See the License</a> for the specific language governing permissions and limitations under the License.
{&ldquo;mode&rdquo;:&ldquo;full&rdquo;,&ldquo;isActive&rdquo;:false}</p><p>Project link: <a href=https://github.com/joematt/pincache.swift/>https://github.com/joematt/pincache.swift/</a></p><ul class=tags><li><a class=tag href=/tags/swift>Swift</a></li><li><a class=tag href=/tags/ios>iOS</a></li><li><a class=tag href=/tags/tvos>tvOS</a></li><li><a class=tag href=/tags/github>github</a></li></ul></div></section><span style=color:#999;font-size:60%>Nifty <a href=https://codepen.io/wbeeftink/pen/dIaDH>tech tag lists</a> from <a class=pen-owner-link href=https://codepen.io/wbeeftink>Wouter Beeftink</a></span></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js></script><script src=/js/resume.js></script><script async src="https://www.googletagmanager.com/gtag/js?id="></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","")</script></body></html>